<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UMS - Courses</title>


  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

  <!-- Bootstrap Table plugin -->
  <link href="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.css" rel="stylesheet">

  <!-- Sticky Header extension to the plugin -->
  <link href="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/sticky-header/bootstrap-table-sticky-header.css"
    rel="stylesheet">

  <!-- Filter control extension to the plugin -->
  <!-- <link rel="stylesheet" type="text/css"
    href="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/filter-control/bootstrap-table-filter-control.min.css"> -->

  <!-- Fixed columns extension to the plugin -->
  <!-- <link
    href="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/fixed-columns/bootstrap-table-fixed-columns.min.css"
    rel="stylesheet"> -->

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
  <link href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" rel="stylesheet"
    integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

  <!-- Local stylesheets -->
  <link rel="stylesheet" href="css/style.css">

</head>

<body>

  <div id="modals-placeholder">
  </div>

  <div id="toast-placeholder">
  </div>

  <nav id="nav-placeholder">
  </nav>

  <div id="loading-placeholder">
  </div>




  <div class="container">

    <h3 class="h3 mt-4">Courses list<br />
      <small class="h4 text-muted">List of all the courses offered by the university</small>
    </h3>

    <div class="my-3">
      <table id="table"></table>
    </div>


    <h4 class="h4 mt-5">Actions</h4>
    <div id="buttons-placeholder">
    </div>


  </div>



  <!-- JQuery script -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <!-- Bootstrap 5 script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>

  <!-- Bootstrap Table plugin script -->
  <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>

  <!-- Sticky Header extension script -->
  <script
    src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.js"></script>

  <!-- Filter control extension script -->
  <!-- <script
    src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script> 
  <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/filter-control/utils.min.js"></script>-->

  <!-- Fixed columns extension script -->
  <!-- <script
    src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/fixed-columns/bootstrap-table-fixed-columns.min.js"></script> -->

  <!-- Print extension script -->
  <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/print/bootstrap-table-print.min.js"></script>

  <!-- Export extension scripts -->
  <script src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/tableExport.min.js"></script>
  <script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/libs/html2canvas/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/libs/jsPDF/jspdf.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/libs/jsPDF-AutoTable/jspdf.plugin.autotable.min.js"></script>
  <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/export/bootstrap-table-export.min.js"></script>


  <!-- Key events extension scripts -->
  <script
    src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/key-events/bootstrap-table-key-events.min.js"></script>

  <!-- Local scripts -->
  <script type="text/javascript" src="js/tableScript.js"></script>
  <script type="text/javascript" src="js/buttonsScript.js"></script>
  <script type="text/javascript" src="js/modalsScript.js"></script>
  <script type="text/javascript" src="js/toastScript.js"></script>
  <script type="text/javascript" src="js/navbarScript.js"></script>
  <script type="text/javascript" src="js/loadingScript.js"></script>
  <script type="text/javascript" src="js/formattersScript.js"></script>








  <script>

    $(document).ready(function () {

      degreesButtons.remove();
      levelButtons.remove();
      sanctionButtons.remove();
      rewardButtons.remove();
      TBDButtons.remove();
      coursesButtons.remove();

      newEntryPersonButton.remove();
      editEntryPersonButton.remove();

      editEntryStudyButton.disabled = true;


      //testButtonABC.addEventListener('click', getStudents);

      newEntryStudyButton.addEventListener('click', getDepartments)

      buttons.classList.remove("invisible");

    });





    // MULTIPLE
    // PUT - ...FORM...
    //setNewProfessorButton.addEventListener('click', setNewProfessorFunction)

    function testFunction() {
      console.log("testFunction")
      //modalConfirmButton.removeEventListener('click', setNewProf)

      // Getting the ids of the current rows
      /* let currentRows = $table.bootstrapTable('getData');
      var currentRowsId = [];
      for (let i = 0; i < currentRows.length; i++) {
        currentRowsId.push(currentRows[i].id)
      }

      // To force the user to wait for the response
      //disableButtonsInModal();

      // Performing the operation
      const response = await fetch('http://localhost:8080/courses/setNewProfessorMultiple', {
        method: 'put',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
        },
        body: new URLSearchParams({
          "coursesIdList": currentRowsId,
          "professorCode": "X100"
        })
      }).then(response => response.json())
        .then(data => {
          console.log(data);

          // To let the user perform other actions afterward
          //enableButtonsInModal();

          // If the Java method throws an exception
          if (checkIfErrorOccurred(data)) {
            return;
          }

          // Extracting the new value from the response
          let temp = data.data.professor;
          let professorReturned = {
            id: temp.id,
            code: temp.code,
            lastName: temp.lastName,
            firstName: temp.firstName
          }

          // Update the current table with the changed value returned
          for (let index = 0; index < currentRows.length; index++) {
            $table.bootstrapTable('updateCell', {
              index: index,
              field: 'professor',
              value: professorReturned
            })
          }

          // Update history with the changes made
          updateHistoryWithChanges($table)

          /* Fetching changed rows
          let newCurrentRows = $table.bootstrapTable('getData');

          // Fetching saved history
          var history = JSON.parse(localStorage["history"]);

          // Modified rows
          for (let i = 0; i < newCurrentRows.length; i++) {

            // History tables
            for (let j = 0; j < history.length; j++) {

              // History rows
              for (let k = 0; k < history[j].length; k++) {

                if (newCurrentRows[i].id == history[j][k].id) {
                  // Updating the item of the history
                  history[j].splice(k, 1, newCurrentRows[i]);
                }
              }
            }
          }

          // Saving the changes
          localStorage["history"] = JSON.stringify(history); 
        })/* .catch(error => {
          console.log(error);
        }) ; */
    };




    // DOM elements
    var $table = $('#table')
    var undoChain = 1;
    var lastDoAction = 'undo';
    let history = [];

    // Columns
    var modelColumns =
      [
        {
          field: 'id',
          title: 'ID',
          //visible: false,
          switchable: false,
          filterControl: 'input'
        }, {
          field: 'code',
          title: 'Code',
          filterControl: 'input'
        }, {
          field: 'heading',
          title: 'Heading',
          filterControl: 'input'
        }, {
          field: 'department',
          title: 'Department',
          filterControl: 'select'
        }, {
          field: 'isExamMadeByProfessor',
          title: 'Exam made',
          filterControl: 'select'
        }, {
          field: 'isExamTakenByStudents',
          title: 'Exam taken',
          filterControl: 'select'
        }, {
          field: 'professor',
          title: 'Professor',
          filterControl: 'select'
        }, {
          field: 'degree',
          title: 'Part of degree',
          visible: false,
          filterControl: 'input'
        }, {
          field: 'students',
          title: 'Students enrolled',
          filterControl: 'input'
        }
      ]

    // Array from JSON Objects
    var sourceData;
    $.ajax("http://localhost:8080/courses/list", {
      success: function (response) {
        sourceData = response.data.courses;
        history.push(sourceData);
        buildTable($table, sourceData, modelColumns, history, undoChain, lastDoAction, 0);

      }, complete: function () {
        console.log("complete multiple");
      }
    })




  </script>

</body>

</html>